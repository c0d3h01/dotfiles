#!/bin/sh

MSG_FILE="$1"
SUBJECT="$(sed -n '1p' "$MSG_FILE")"

# Allow Git-generated and history-rewrite commit subjects.
case "$SUBJECT" in
Merge\ * | Revert\ * | fixup!\ * | squash!\ *)
	exit 0
	;;
esac

# Enforce: type(scope)!: message
# Scope and ! are optional.
PATTERN='^(feat|fix|refactor|chore|docs|test|perf|build|ci|style|revert)(\([a-z0-9._/-]+\))?(!)?: .+'

if ! printf '%s\n' "$SUBJECT" | grep -Eq "$PATTERN"; then
	exit 1
fi

exit 0
