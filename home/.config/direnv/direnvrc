# Silence direnv warnings
export DIRENV_SILENT=true

# Enable nix-direnv equivalent if available
if command -v use_nix &>/dev/null; then
    use_nix() {
        # fallback to nix-direnv-like behavior
        eval "$(nix print-dev-env)"
    }
fi

# Persistent layout cache
: "${XDG_CACHE_HOME:=$HOME/.cache}"
declare -A direnv_layout_dirs

direnv_layout_dir() {
    # Hash the current directory to create a unique layout path
    local hash
    hash=$(echo -n "$PWD" | sha1sum | cut -d ' ' -f1)
    echo "${direnv_layout_dirs[$PWD]:=$XDG_CACHE_HOME/direnv/layouts/$hash}"
}

# Hook into direnv layout command
layout_dir() {
    local layout
    layout=$(direnv_layout_dir)
    mkdir -p "$layout"
    export DIRENV_LAYOUT="$layout"
}

# Optional: auto-setup for every environment
layout_dir
